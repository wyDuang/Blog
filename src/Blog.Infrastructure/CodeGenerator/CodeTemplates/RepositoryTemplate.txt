using Microsoft.EntityFrameworkCore;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using YDQZ.Core.Entities;
using YDQZ.Core.Interfaces;
using YDQZ.Infrastructure.Database;
using YDQZ.Infrastructure.Extensions;
using YDQZ.Infrastructure.Resources;
using YDQZ.Infrastructure.Services;

namespace {RepositoryNamespace}
{
	/// <summary>
	/// {Comment}（仓储层实现）
	/// </summary>
    public class {ClassName}Repository : I{ClassName}Repository
    {
		private readonly MyContext _myContext;
        private readonly IPropertyMappingContainer _propertyMappingContainer;
        public {ClassName}Repository(
			MyContext myContext,
            IPropertyMappingContainer propertyMappingContainer)
        {
            _myContext = myContext;
            _propertyMappingContainer = propertyMappingContainer;
        }

		public async Task<PaginatedList<{ClassName}>> GetPageListAsync({ClassName}Parameters parm)
        {
			var query = _myContext.{TableName}.AsQueryable();

			//TODO: 条件


			query = query.ApplySort(parm.OrderBy, _propertyMappingContainer.Resolve<{ClassName}Resource, {ClassName}>());

			var count = await query.CountAsync();
			var data = await query
                .Skip(parm.PageIndex * parm.PageSize)
                .Take(parm.PageSize)
                .ToListAsync();

            return new PaginatedList<{ClassName}>(parm.PageIndex, parm.PageSize, count, data);
        }

		public async Task<{ClassName}> GetAsync(int id)
        {
            return await _myContext.{TableName}.FindAsync(id);
        }

		public void Add({ClassName} model)
        {
            _myContext.{TableName}.Add(model);
        }

        public void Delete({ClassName} model)
        {
            _myContext.{TableName}.Remove(model);
        }

        public void Update({ClassName} model)
        {
            _myContext.Entry(model).State = EntityState.Modified;
        }
    }
}